
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Tom van Ommeren's blog</title>
	<meta name="author" content="Tom van Ommeren">

	
	<meta name="description" content="Yii is a sort of Ruby on Rails clone. You get some of the good features (migrations for example), but not the amazing language or community. The &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Tom van Ommeren's blog" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Tom van Ommeren's blog</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:tomv564.github.io">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/tomvanommeren" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/tomv564" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:tomv564.github.io">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/06/17/maintaining-legacy-yii-php-apps/">
		
			Maintaining Legacy Yii PHP Apps</a>
	</h2>
	<div class="entry-content">
		<p>Yii is a sort of Ruby on Rails clone. You get some of the good features (migrations for example), but not the amazing language or community.</p>

<p>The application architecture is probably good enough for simple forms-to-mysql webapps. Unfortunately the framework provides little guidance once complexity grows, so be prepared for monster models and controllers. Tooling isn&rsquo;t great either, so soon I found myself littering var_dumps all over the code and F5-ing in the browser like it&rsquo;s 1998.</p>

<h3>So what can you do?</h3>

<p><strong>Automate deployment</strong> because it&rsquo;s so easy with PHP. We stopped working on the server and now push to a bare git repository with a post-receive hook to checkout and run migrations. If you deploy PHP applications to IIS, you can use a similar setup <a href="/blog/2014/03/28/git-push-deployment-on-iis/">I wrote about before</a>.</p>

<p><strong>Set up a build server</strong>. I like TeamCity with the PHP meta-runners, but Travis CI is an option if your source is public or you have money.
Even if there are no tests, you can run PHP lint on the whole directory. You can catch some real stupid errors this way.</p>

<p><strong>Make unit testing cheap</strong>. Document how to set up the right PHPUnit (<a href="https://github.com/yiisoft/yii/issues/1563">YII is picky</a>), and make it only a keystroke/click away. (Psst, using Sublime Text? I have a <a href="https://github.com/tomv564/SimplePHPUnit">Yii-friendly version of the SimplePHPUnit plugin</a>)</p>

<p><strong>Finally, run the tests on the build server</strong>.
If your migration history is incomplete like ours was, you may also have to set up a set up a minimal database build. We keep a mysqldump the structure of a recent database on the build server. Every build this database is restored, followed by a <code>yiic migrate</code>.</p>

<h3>What does it get you?</h3>

<p>Having this set up has not allowed significant refactorings or converted us to TDD. But the last few months I&rsquo;ve noticed some changes of habit:</p>

<p>It&rsquo;s more worthwhile to fix little bugs and annoyances because deployments are safe and fast. As a bonus, the fixes also always make it into version control.</p>

<p>We&rsquo;ve also had some valuable fixes sitting in still-dodgy code. After writing some tests, I felt safe pushing it live. Any new bugs would be triaged quickly because <em>writing more tests was now cheap.</em></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-06-17T00:00:41+02:00" pubdate data-updated="true">Jun 17<span>th</span>, 2014</time></div>
	<div class="tags">

</div>
	
</div>
</article>

<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2014

    Tom van Ommeren

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->




	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-7601332-2']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>