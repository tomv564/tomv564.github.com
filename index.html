
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Tom van Ommeren's blog</title>
  <meta name="author" content="Tom van Ommeren">

  
  <meta name="description" content="Now that I&rsquo;m not just slinging C# all day, there are some interesting new problems.
Like PHP hotfixes that need to be deployed to Windows and &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tomv564.github.io/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
   <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Tom van Ommeren's blog" type="application/atom+xml">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Lato:400,100,100italic,300,300italic,400italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Lora:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Source+Code+Pro:200,300,400,500,600,700,900' rel='stylesheet' type='text/css'>




  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-7601332-2', 'tomv.github.io');
  ga('send', 'pageview');

</script>


  <style>html{background: url("/images/background.png") no-repeat center center fixed;-webkit-background-size: cover;-moz-background-size: cover;-o-background-size: cover;background-size: cover;}</style>
</head>

<body   >
  <header role="banner"><hgroup>
</hgroup>

</header>
  <!-- <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tomv564.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav> -->
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/28/git-push-deployment-on-iis/">Git Push Deployment on IIS</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-28T18:49:41+01:00" pubdate data-updated="true">Mar 28<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Now that I&rsquo;m not just slinging C# all day, there are some interesting new problems.
Like PHP hotfixes that need to be deployed to Windows and Ubuntu boxes on a whim.
Currently, we&rsquo;re using WinMerge or even Filezilla to push invidual files across, and I yearn to be able to just do this:</p>

<p><code>git push live</code></p>

<p>On the Ubuntu servers, <a href="http://mikeeverhart.net/git/using-git-to-deploy-code/">this is easy</a></p>

<p>On Windows,</p>

<ul>
<li>Follow the <a href="http://bonobogitserver.com/install/">installation instructions</a> to install Bonobo Git Server</li>
<li>Create a repository for yourapp in Bonobo</li>
<li>Create a web application in IIS for yourapp, under eg. <strong>c:\inetpub\yourapp</strong></li>
<li>Grant the <strong>IIS_IUSRS</strong> group write permissions to this directory.</li>
<li>Locate your repository in Bonobo&rsquo;s <strong>App_Data</strong> folder and add the following in <strong>hooks\post-receive</strong></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/bin/sh
</span><span class='line'>git checkout -f  </span></code></pre></td></tr></table></div></figure>


<p>Also edit the config of the repository, making sure at least the following settings are present:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[core]
</span><span class='line'>  bare = false
</span><span class='line'>  worktree = /inetpub/yourapp
</span><span class='line'>[recieve]
</span><span class='line'>  denycurrentworktree = ignore</span></code></pre></td></tr></table></div></figure>


<p>Finally, add the remote to your local git repository:</p>

<p><code>git remote add myserver http://admin@mywindowsserver/yourapp.git</code></p>

<p>You&rsquo;re good to go:</p>

<p><code>git push myserver</code></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/26/mastermind-part-3-a-web-app/">MasterMind Part 3: A Web App</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-26T17:23:40+01:00" pubdate data-updated="true">Jan 26<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>So you have tested server logic in Ruby, and a working front-end prototype. What is the easiest way to hook them up?</p>

<p>I had some experience with <a href="http://rubyonrails.org/">Ruby on Rails</a> so I first generated a rails app to handle the backend. A large directory structure filled with boilerplate appeared, Turbolinks broke my event handlers, and I decided a microframework like <a href="http://www.sinatrarb.com">Sinatra</a> was much better suited to the task.</p>

<h3>Install sinatra</h3>

<p>Run this in your project directory</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem install sinatra</span></code></pre></td></tr></table></div></figure>


<h3>Move your frontend</h3>

<p>Sinatra expects all your HTML, CSS and javascript to live in a subfolder named <em>public</em>.</p>

<ul>
<li>public (index.html)

<ul>
<li>js (app.js, jquery.min.js, bootstrap.min.js)</li>
<li>css (app.css, bootstrap.css)</li>
<li>fonts (Bootstrap glyphicons)</li>
</ul>
</li>
</ul>


<h3>Create a controller.rb in the root to serve it all up</h3>

<figure class='code'><figcaption><span>controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;sinatra&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;json&#39;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">redirect</span> <span class="s1">&#39;/index.html&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>And fire it up using</p>

<figure class='code'><figcaption><span>controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">ruby</span> <span class="n">controller</span><span class="o">.</span><span class="n">rb</span>
</span></code></pre></td></tr></table></div></figure>


<p>Webrick should be fired up and serving index.html on <a href="http://localhost:4567/">http://localhost:4567/</a></p>

<h3>Add the New Game action</h3>

<p>How do we keep the multiple games running on the server apart?</p>

<p>Add the <em>securerandom</em> gem, and add a read-only id property on our Game object:</p>

<figure class='code'><figcaption><span>game.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;securerandom&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Game</span>
</span><span class='line'>    <span class="vi">@answer</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>    <span class="kp">attr_reader</span> <span class="ss">:id</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
</span><span class='line'>      <span class="n">validate_code</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
</span><span class='line'>      <span class="vi">@answer</span> <span class="o">=</span> <span class="n">answer</span>
</span><span class='line'>      <span class="vi">@id</span> <span class="o">=</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">hex</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>We need to store this game object between requests, and we&rsquo;re not going to use a database for this. Instead, we&rsquo;ll set up a hash in Sinatra&rsquo;s configuration when the app loads:</p>

<figure class='code'><figcaption><span>controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">require_relative</span> <span class="s1">&#39;game&#39;</span>
</span><span class='line'><span class="n">require_relative</span> <span class="s1">&#39;generator&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">configure</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">set</span> <span class="ss">:games</span><span class="p">,</span> <span class="no">Hash</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>In your app.js, your reset function should request a new game:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/game&#39;</span><span class="p">,</span> <span class="nx">onGameCreated</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Your server creates, stores and returns the new game:</p>

<figure class='code'><figcaption><span>controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">post</span> <span class="s1">&#39;/game&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="c1"># create a new game</span>
</span><span class='line'>  <span class="n">answer</span> <span class="o">=</span> <span class="no">Generator</span><span class="o">.</span><span class="n">generate</span>
</span><span class='line'>  <span class="n">game</span> <span class="o">=</span> <span class="no">Game</span><span class="o">.</span><span class="n">new</span> <span class="n">answer</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># store the game to be looked up by id</span>
</span><span class='line'>  <span class="n">settings</span><span class="o">.</span><span class="n">games</span><span class="o">[</span><span class="n">game</span><span class="o">.</span><span class="n">id</span><span class="o">]</span> <span class="o">=</span> <span class="n">game</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># tell Sinatra we are speaking JSON</span>
</span><span class='line'>  <span class="n">content_type</span> <span class="ss">:json</span>
</span><span class='line'>  <span class="n">game</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">to_json</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Back on the client, your onGameCreated function should extract the id and store it for future requests</p>

<figure class='code'><figcaption><span>app.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">gameId</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">onGameCreated</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">gameId</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Restart your sinatra host, and you should see an AJAX request going out to your server as soon as the page hits your reset() method.</p>

<h3>Add the Guess action</h3>

<p>Once the player has selected four colors I allow then to submit the guess. See here the use of gameId, and colors is passed as an array in the POST payload.</p>

<figure class='code'><figcaption><span>app.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/game/&#39;</span> <span class="o">+</span> <span class="nx">gameId</span> <span class="o">+</span> <span class="s1">&#39;/guesses&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;colors[]&#39;</span><span class="o">:</span> <span class="nx">colors</span><span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="nx">onGuessAdded</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Your web handler should look something like this:</p>

<figure class='code'><figcaption><span>controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">post</span> <span class="s1">&#39;/game/:id/guesses&#39;</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1"># find the game</span>
</span><span class='line'>        <span class="n">game</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">games</span><span class="o">[</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]]</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1"># parse the parameters (convert to symbols)</span>
</span><span class='line'>        <span class="n">colors</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:colors</span><span class="o">]</span>
</span><span class='line'>        <span class="n">guess</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">c</span><span class="o">.</span><span class="n">to_sym</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1"># add a guess</span>
</span><span class='line'>        <span class="n">score</span> <span class="o">=</span> <span class="n">game</span><span class="o">.</span><span class="n">guess</span> <span class="n">guess</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1"># return the score</span>
</span><span class='line'>        <span class="n">content_type</span> <span class="ss">:json</span>
</span><span class='line'>        <span class="n">score</span><span class="o">.</span><span class="n">to_json</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Things I think are great about this code:</p>

<ul>
<li>You can pull params from the requested URL or the postdata</li>
<li>The RESTful method signature is very descriptive: Post this guess to the guesses of the game identified by id.</li>
</ul>


<p>Only the converting of strings to symbols is a bit unproductive.</p>

<h3>Deploy to a server</h3>

<p>Because I don&rsquo;t want to set up my own server, and Platform-as-a-Service providers often have restricted free accounts, we will deploy the app to <a href="http://www.heroku.com/">Heroku</a>.</p>

<p>Their <a href="https://devcenter.heroku.com/articles/quickstart">Getting Started</a> page walks you through signing up, installing the client tools and deployment. Once you&rsquo;re ready to deploy, check the rest of this blog post.</p>

<p>Using their <a href="https://devcenter.heroku.com/articles/rack">instructions for Rack apps</a> we will set up the Gemfile and config.ru in the root:</p>

<figure class='code'><figcaption><span>Gemfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>
</span><span class='line'><span class="n">gem</span> <span class="s2">&quot;bundler&quot;</span>  <span class="p">,</span> <span class="s2">&quot;~&gt; 1.3.5&quot;</span>
</span><span class='line'><span class="n">gem</span> <span class="s2">&quot;rspec&quot;</span>    <span class="p">,</span> <span class="s2">&quot;~&gt; 2.14.1&quot;</span>
</span><span class='line'><span class="n">gem</span> <span class="s2">&quot;sinatra&quot;</span>
</span><span class='line'><span class="n">gem</span> <span class="s2">&quot;securerandom&quot;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>config.ru</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;./controller&#39;</span>
</span><span class='line'><span class="n">run</span> <span class="ss">Sinatra</span><span class="p">:</span><span class="ss">:Application</span>
</span></code></pre></td></tr></table></div></figure>


<p>You should have run heroku login at this point, so we are ready to create and deploy the app using a git push:</p>

<figure class='code'><figcaption><span>config.ru</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">heroku</span> <span class="n">create</span>
</span><span class='line'><span class="n">git</span> <span class="n">push</span> <span class="n">heroku</span> <span class="n">master</span>
</span><span class='line'><span class="n">heroku</span> <span class="nb">open</span>
</span></code></pre></td></tr></table></div></figure>


<p>You should be up and running! The free Heroku instances tend to go to sleep every once in awhile.
If the app is still running, the url is at: <a href="http://tomv-mastermind.herokuapp.com">Tom&rsquo;s MasterMind</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/26/mastermind-part-2-adding-a-front-end/">MasterMind Part 2: Adding a Front End</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-26T16:31:49+01:00" pubdate data-updated="true">Jan 26<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The <a href="/blog/2013/12/14/ruby-rspec-and-git-a-guessing-game/">previous post</a> was an exercise in building well-tested logic. To turn this in to a workable application, two things need to happen:</p>

<ol>
<li>A front-end needs to be built</li>
<li>The back-end needs to be hosted in a web app</li>
</ol>


<p>In fact, you could build the whole thing as a front-end app, but then you would miss out on building a minimalistic Ruby web app.</p>

<p>So, let&rsquo;s mock up a front end in <a href="http://www.balsamiq.com/">Balsamiq</a>.</p>

<p><img src="https://raw2.github.com/tomv564/mastermind/master/mockup.png" alt="mockup" /></p>

<h3>HTML template</h3>

<p>Because I don&rsquo;t want to work hard to get pretty fonts and buttons, <a href="http://getbootstrap.com">download Bootstrap</a> and use their basic html template.</p>

<p>The board is made up of nested lists, the markup looks roughly like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;board&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">&quot;answer&quot;</span> <span class="na">class=</span><span class="s">&quot;code list-unstyled&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;li&gt;</span>?<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>      <span class="nt">&lt;li&gt;</span>?<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>      <span class="nt">&lt;li&gt;</span>?<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>      <span class="nt">&lt;li&gt;</span>?<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">&quot;guesses&quot;</span> <span class="na">class=</span><span class="s">&quot;list-unstyled&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;li&gt;</span>
</span><span class='line'>        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;code list-unstyled&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;li&gt;&lt;/li&gt;</span>
</span><span class='line'>          <span class="nt">&lt;li&gt;&lt;/li&gt;</span>
</span><span class='line'>          <span class="nt">&lt;li&gt;&lt;/li&gt;</span>
</span><span class='line'>          <span class="nt">&lt;li&gt;&lt;/li&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;score list-unstyled&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;black&quot;</span><span class="nt">&gt;</span><span class="ni">&amp;nbsp;</span><span class="nt">&lt;/li&gt;</span>
</span><span class='line'>          <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;white&quot;</span><span class="nt">&gt;</span><span class="ni">&amp;nbsp;</span><span class="nt">&lt;/li&gt;</span>
</span><span class='line'>          <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;white&quot;</span><span class="nt">&gt;</span><span class="ni">&amp;nbsp;</span><span class="nt">&lt;/li&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;addguess&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;code list-unstyled&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;li&gt;&lt;/li&gt;</span>
</span><span class='line'>      <span class="nt">&lt;li&gt;&lt;/li&gt;</span>
</span><span class='line'>      <span class="nt">&lt;li&gt;&lt;/li&gt;</span>
</span><span class='line'>      <span class="nt">&lt;li&gt;&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>    <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">&quot;addguessbutton&quot;</span> <span class="na">type=</span><span class="s">&quot;button&quot;</span> <span class="na">class=</span><span class="s">&quot;btn btn-xs btn-primary&quot;</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;glyphicon glyphicon-ok&quot;</span><span class="nt">&gt;&lt;/span&gt;&lt;/button&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">&quot;turns&quot;</span> <span class="na">class=</span><span class="s">&quot;list-unstyled&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li&gt;</span>
</span><span class='line'>      <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;code list-unstyled&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;li&gt;&lt;/li&gt;</span>
</span><span class='line'>        <span class="nt">&lt;li&gt;&lt;/li&gt;</span>
</span><span class='line'>        <span class="nt">&lt;li&gt;&lt;/li&gt;</span>
</span><span class='line'>        <span class="nt">&lt;li&gt;&lt;/li&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>     <span class="nt">&lt;li&gt;</span>
</span><span class='line'>      <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;code list-unstyled&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;li&gt;&lt;/li&gt;</span>
</span><span class='line'>        <span class="nt">&lt;li&gt;&lt;/li&gt;</span>
</span><span class='line'>        <span class="nt">&lt;li&gt;&lt;/li&gt;</span>
</span><span class='line'>        <span class="nt">&lt;li&gt;&lt;/li&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The following CSS turns those list items into circles:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nt">ul</span><span class="nc">.code</span> <span class="nt">li</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">float</span><span class="o">:</span> <span class="k">left</span><span class="p">;</span>
</span><span class='line'>        <span class="k">border</span><span class="o">:</span> <span class="m">2px</span> <span class="k">solid</span> <span class="m">#999</span><span class="p">;</span>
</span><span class='line'>        <span class="k">margin-left</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
</span><span class='line'>        <span class="k">width</span><span class="o">:</span> <span class="m">30px</span><span class="p">;</span>
</span><span class='line'>        <span class="k">height</span><span class="o">:</span> <span class="m">28px</span><span class="p">;</span>
</span><span class='line'>        <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">20px</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Tying it together: the javascript</h3>

<p>To encapsulate the logic for the whole page, I started with this basic pattern:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">Mastermind</span> <span class="o">=</span> <span class="k">new</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// private variables</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">selectedPeg</span><span class="p">;</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">lastGuess</span><span class="p">;</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">gameId</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// private functions </span>
</span><span class='line'>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">addGuess</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">reset</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// first load: attach handlers and reset game.</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#newgamebutton&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="nx">reset</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#addguessbutton&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="nx">addGuess</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">reset</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>                <span class="c1">// public functions and variables</span>
</span><span class='line'>
</span><span class='line'>        <span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="p">}();</span>
</span></code></pre></td></tr></table></div></figure>


<p>It is based on <a href="http://javascript.crockford.com/private.html">Crockford&rsquo;s private members in Javascript</a> and helps keep your objects tight and neat.</p>

<p>Filling in the details is a mix of DOM manipulation using JQuery and lots of trial-and-error. See the <a href="https://github.com/tomv564/mastermind/blob/d01d3bf8de635b97462c6aa7060f7b679a6f37ef/js/app.js">complete javascript</a> for some ideas.</p>

<p>The front end implementation is deliberately dumb &ndash; it should only allow picking colors and submitting guesses. The game logic will be hooked up in the next step, when we convert our Ruby class into a web app.</p>

<p>The implementation at this point can be seen at <a href="https://github.com/tomv564/mastermind/tree/d01d3bf8de635b97462c6aa7060f7b679a6f37ef">this commit in GitHub</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/14/ruby-rspec-and-git-a-guessing-game/">Ruby, Rspec and Git, a Guessing Game</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-14T00:00:00+01:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Let&rsquo;s make a game. Better yet, let&rsquo;s copy one. Let&rsquo;s implement <a href="http://en.wikipedia.org/wiki/Mastermind_(board_game">MasterMind</a> in Ruby.</p>

<p>The living project for this article is on <a href="https://github.com/tomv564/mastermind">GitHub</a></p>

<h3>Prep</h3>

<p>First, set up a ruby on your machine using <a href="http://railsapps.github.io/installrubyonrails-mac.html">this guide</a> about RVM.</p>

<p>Create an empty class, we&rsquo;ll call it game.rb.
For Ruby, RSpec and TestUnit are popular. We&rsquo;ll use RSpec for now:</p>

<p>First, install the rspec gem:</p>

<div>
  <pre><code class='bash'>gem install rspec</code></pre>
</div>


<p>Rspec seems happiest when you put all the tests in a spec folder, so let&rsquo;s go ahead create our test file in <strong>spec/game_spec.rb</strong></p>

<h3>Write some tests</h3>

<p>Here is our first test scenario:</p>

<div>
  <pre><code class='ruby'>require_relative &#39;../game&#39;

describe Game do 
    it &quot;requires an answer&quot; do
        expect{Game.new}.to raise_error(ArgumentError)
    end     
end</code></pre>
</div>


<p>This file tells RSpec</p>

<ol>
<li>Load a Ruby object called <em>game</em> from the parent directory</li>
<li>We are going to test an object called <em>Game</em></li>
<li>This test case is called <em>requires an answer</em></li>
<li><strong>expect</strong> warns RSpec that <em>Game.new</em> will throw an Exception</li>
<li>We expect this exception to be an <em>ArgumentError</em>.</li>
</ol>


<h3>Run them</h3>

<p>As long as all your spec files live in a spec directory, you can simply type the following your project directory:</p>

<div>
  <pre><code class='bash'>rspec</code></pre>
</div>


<p>You should see 1 failed test.</p>

<h3>Write some code</h3>

<p>You&rsquo;re on your own here. Read up on the Mastermind rules on Wikipedia, then code:</p>

<ol>
<li>Write a failing test</li>
<li>Write the minimal amount of code to fix the test</li>
<li>Goto 1</li>
<li>Refactor to clean up as necessary</li>
</ol>


<h2>So, you&rsquo;re done</h2>

<p>You have a working game class. We want to take a moment to save our progress.</p>

<h3>Create a git repository</h3>

<p>First, convert your project to a local git repository</p>

<div>
  <pre><code class='bash'>git add .
git commmit -m &#39;initial commit&#39;</code></pre>
</div>


<h3>Push it to github</h3>

<ol>
<li>Create the repository on GitHub <a href="https://help.github.com/articles/create-a-repo">Instructions here</a></li>
<li>Add the github repository as the origin remote (<a href="https://help.github.com/articles/adding-a-remote">See this help page</a></li>
</ol>


<div>
  <pre><code class='bash'>git remote add origin https://github.com/user/repo.git # replace user and repo with your own repository details</code></pre>
</div>


<ol>
<li>Push-pull to sync</li>
</ol>


<div>
  <pre><code class='bash'>git pull origin master
git push origin master</code></pre>
</div>


<h2>Automating the tests</h2>

<p>Your work is now saved outside your machine, you can give others access to your repository and collaborate. But with everyone stirring the pot at the same time, how do you know everything&rsquo;s still working? The answer is continuous integration: we&rsquo;re going to run a service to run the tests whenever someone checks in code.</p>

<h3>Set up a rake task</h3>

<p>We need a way to tell a 3rd party how to run the tests on our project. In Ruby, this is called the <strong>Rakefile</strong>:</p>

<div>
  <pre><code class='ruby'>require &#39;rspec/core/rake_task&#39;

RSpec::Core::RakeTask.new(:spec)

task :default =&gt; :spec</code></pre>
</div>


<p>This does the following:</p>

<ol>
<li>Tell Rake we want to use rspec</li>
<li>Creates an RSpec task, naming it :spec</li>
<li>Tells Rake that the default task is our :spec task.</li>
</ol>


<p>Create and save this file in the project&rsquo;s directory, and run the following:</p>

<div>
  <pre><code class='bash'>rake</code></pre>
</div>


<p>You can see that rake starts up RSpec, the output should be the same as running rspec.</p>

<h3>Set up a gemfile for Travis</h3>

<p>The service we&rsquo;re going to use, <a href="https://travis-ci.org">Travis</a>, now knows how it can run our tests. But it has no idea what our ruby environment looks like. We need to create these files in our project directory.</p>

<h4>.travis.yml</h4>

<div>
  <pre><code class='ruby'>language: ruby
rvm:
  - 2.0.0</code></pre>
</div>


<p>This file tells Travis that we are a ruby project, and we want Ruby 2.0.0</p>

<h4>Gemfile</h4>

<div>
  <pre><code class='ruby'>source &#39;https://rubygems.org&#39;
gem &quot;rspec&quot;    , &quot;~&gt; 2.14.1&quot;</code></pre>
</div>


<p>This file tells Travis that we want to use a recent version of RSpec.
Create these two files for now, we will send them to GitHub after the next step.</p>

<h3>Sign up for Travis</h3>

<p>Visit <a href="https://travis-ci.org">Travis</a>, sign up with your GitHub account and tell it to sync your MasterMind repository.</p>

<p>To tell Travis to make its first build, add the two files we just created using <strong>git add</strong> and <strong>git push</strong> them to GitHub.</p>

<h3>Watch your inbox.</h3>

<p>This can take a few minutes, but eventually Travis will pick up the changes and try to run the tests on their own server. If it worked, you&rsquo;ll see this reward:</p>

<p><a href="https://travis-ci.org/tomv564/mastermind"><img src="https://travis-ci.org/tomv564/mastermind.png?branch=master" alt="Build Status" /></a></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives/"> Archives </a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section id="titles">
  <a href="http://tomv564.github.io" title="Tom van Ommeren's blog"><img id="logo" src="http://tomv564.github.io/images/" /></a>
  <h1 id="site_title"><a href="http://tomv564.github.io" title="Tom van Ommeren's blog">Tom van Ommeren&#8217;s blog</a></h1>
  <h3 id="site_subtitle">About code, communication and the art of doing less.</h3>
</section>

<section id="menu">
  <ul>
    <li><i class="fa fa-home fa-lg"></i><a href="http://tomv564.github.io"> Home </a></li>
    <li><i class="fa fa-calendar fa-lg"></i><a href="http://tomv564.github.io/blog/archives/"> Archives </a></li>
    <li><i class="fa fa-rss fa-lg"></i><a href="http://tomv564.github.io/atom.xml"> Feed </a></li>
  </ul>
</section>

<section id="social">
  

  

  

  
    <a href="https://github.com/tomv564" title="tomv564"><i class="fa fa-github fa-2x"></i></a>
  

  

  
    <a href="https://twitter.com/tomvanommeren" title="tomvanommeren"><i class="fa fa-twitter fa-2x"></i></a>
  
</section>


<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/03/28/git-push-deployment-on-iis/">Git push deployment on IIS</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/26/mastermind-part-3-a-web-app/">MasterMind Part 3: A web app</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/26/mastermind-part-2-adding-a-front-end/">MasterMind Part 2: Adding a front end</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/14/ruby-rspec-and-git-a-guessing-game/">Ruby, rspec and git, a guessing game</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/tomv564">@tomv564</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'tomv564',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Tom van Ommeren -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
